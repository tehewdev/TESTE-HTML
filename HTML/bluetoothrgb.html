<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detetive de UUID Bluetooth</title>
    <style>
        body { background-color: #121212; color: #e0e0e0; font-family: monospace; padding: 20px; display: flex; flex-direction: column; gap: 15px; }
        button { padding: 20px; font-size: 1.2rem; background: #bb86fc; border: none; border-radius: 8px; font-weight: bold; color: #000; cursor: pointer; }
        .log-box { background: #1e1e1e; border: 1px solid #333; padding: 15px; height: 300px; overflow-y: auto; font-size: 0.8rem; white-space: pre-wrap; }
        .success { color: #03dac6; font-weight: bold; }
        .fail { color: #cf6679; }
        .info { color: #bb86fc; }
    </style>
</head>
<body>
    <h2>üïµÔ∏è‚Äç‚ôÇÔ∏è Detetive de L√¢mpada</h2>
    <p>Vamos descobrir qual o UUID da sua l√¢mpada.</p>
    
    <button id="btnScan">ESCANEAR L√ÇMPADA</button>
    
    <div class="log-box" id="log"></div>

    <script>
        const logBox = document.getElementById('log');
        
        function log(msg, type='') {
            const div = document.createElement('div');
            div.textContent = `> ${msg}`;
            if(type) div.className = type;
            logBox.appendChild(div);
            logBox.scrollTop = logBox.scrollHeight;
        }

        document.getElementById('btnScan').addEventListener('click', async () => {
            try {
                log("Iniciando busca...", 'info');
                
                // Vamos pedir permiss√£o para TODOS os servi√ßos comuns de l√¢mpadas
                const device = await navigator.bluetooth.requestDevice({
                    acceptAllDevices: true,
                    optionalServices: [
                        '0000fff0-0000-1000-8000-00805f9b34fb', // Padr√£o Triones/ELK
                        '0000ffe0-0000-1000-8000-00805f9b34fb', // Padr√£o HM-10 / Serial
                        '0000ffe5-0000-1000-8000-00805f9b34fb', // Variantes antigas
                        '0000180a-0000-1000-8000-00805f9b34fb', // Info do Dispositivo
                        '0000fe50-0000-1000-8000-00805f9b34fb', // Alguns chips Realtek
                        // Adicione outros UUIDs suspeitos aqui se souber
                    ]
                });

                log(`Conectando em: ${device.name || 'Sem Nome'}...`);
                const server = await device.gatt.connect();
                log("Conectado! Lendo servi√ßos...", 'success');

                const services = await server.getPrimaryServices();
                
                if(services.length === 0) {
                    log("Nenhum servi√ßo permitido encontrado. A l√¢mpada usa um UUID propriet√°rio n√£o listado.", 'fail');
                } else {
                    log(`ENCONTRADOS ${services.length} SERVI√áOS:`, 'success');
                    
                    for (const service of services) {
                        log(`--------------------------`);
                        log(`Servi√ßo UUID: ${service.uuid}`, 'success');
                        
                        try {
                            const chars = await service.getCharacteristics();
                            for (const char of chars) {
                                let props = [];
                                if(char.properties.write) props.push("WRITE");
                                if(char.properties.writeWithoutResponse) props.push("WRITE_NO_RESP");
                                if(char.properties.notify) props.push("NOTIFY");
                                
                                log(`  -> Char: ${char.uuid}`);
                                log(`     Props: [${props.join(', ')}]`);
                                
                                if(char.properties.write || char.properties.writeWithoutResponse) {
                                    log(`     *** ESTE PODE SER O COMANDO! ***`, 'info');
                                }
                            }
                        } catch(err) {
                            log(`  -> Erro ao ler caracter√≠sticas: ${err.message}`, 'fail');
                        }
                    }
                    log(`--------------------------`);
                    log(`Tire um print e me mande!`, 'info');
                }

            } catch (err) {
                log("Erro: " + err.message, 'fail');
                if(err.message.includes("No Services matching")) {
                    log("DICA: A l√¢mpada conectou, mas o UUID dela √© super estranho e o navegador bloqueou.", 'fail');
                }
            }
        });
    </script>
</body>
</html>