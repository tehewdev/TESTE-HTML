<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Scanner de Serviços</title>
  <style>
    body { font-family: monospace; background: #111; color: #0f0; padding: 20px; }
    button { font-size: 1.2rem; padding: 10px; cursor: pointer; }
  </style>
</head>
<body>
  <h3>Scanner de Serviços Bluetooth</h3>
  <button id="btn">Escanear Serviços do Sensor</button>
  <div id="log"></div>

  <script>
    const logDiv = document.getElementById('log');
    function log(msg) { logDiv.innerHTML += `<div>${msg}</div>`; console.log(msg); }

    document.getElementById('btn').addEventListener('click', async () => {
      logDiv.innerHTML = '';
      try {
        // Pedimos para ver TUDO
        const device = await navigator.bluetooth.requestDevice({
          acceptAllDevices: true,
          optionalServices: [
            "0000181a-0000-1000-8000-00805f9b34fb", // Temp padrão
            "0000180f-0000-1000-8000-00805f9b34fb", // Bateria
            "ebe0ccb0-7a0a-4b0c-8a1a-6ff2997da3a6"  // Xiaomi Proprietário (Original)
          ]
        });

        log(`Conectando em: ${device.name}...`);
        const server = await device.gatt.connect();
        log("Conectado! Listando serviços primários...");

        const services = await server.getPrimaryServices();
        
        if (services.length === 0) {
          log("Nenhum serviço encontrado (estranho...)");
        }

        let achouPadrao = false;
        let achouXiaomi = false;

        for (const service of services) {
          log(`--------------------------`);
          log(`UUID Encontrado: ${service.uuid}`);
          
          if (service.uuid.includes("181a")) {
            log("✅ SERVIÇO PADRÃO (ATC) ENCONTRADO!");
            achouPadrao = true;
          }
          if (service.uuid.includes("ebe0")) {
            log("⚠️ SERVIÇO XIAOMI ORIGINAL ENCONTRADO.");
            achouXiaomi = true;
          }
        }

        log(`--------------------------`);
        if (achouXiaomi && !achouPadrao) {
          log("VEREDITO: Você está com firmware ORIGINAL. O código web não vai funcionar fácil. Troque para ATC.");
        } else if (achouPadrao) {
          log("VEREDITO: Firmware correto! O código de leitura deveria funcionar.");
        }

        device.gatt.disconnect();
      } catch (err) {
        log("ERRO: " + err.message);
      }
    });
  </script>
</body>
</html>