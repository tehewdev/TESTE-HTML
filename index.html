<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Editor Online & Lista de Testes HTML</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA2NCA2NCI+CiAgPGRlZnM+CiAgICA8bGluZWFyR3JhZGllbnQgaWQ9ImEiIHgxPSIwJSIgeTE9IjAlIiB4Mj0iMTAwJSIgeTI9IjEwMCUiPgogICAgICA8c3RvcCBvZmZzZXQ9IjAlIiBzdG9wLWNvbG9yPSIjNjY3ZWVhIiAvPgogICAgICA8c3RvcCBvZmZzZXQ9IjEwMCUiIHN0b3AtY29sb3I9IiM3NjRiYTIiIC8+CiAgICA8L2xpbmVhckdyYWRpZW50PgogIDwvZGVmcz4KICA8cmVjdCB3aWR0aD0iNjQiIGhlaWdodD0iNjQiIHJ4PSIxNCIgZmlsbD0idXJsKCNhKSIgLz4KICA8cGF0aCBmaWxsPSIjZmZmZmZmIiBkPSJNMjEgMThoOGw1IDkgNS05aDhsLTkgMTZ2MTJoLThWMzR6IiAvPgo8L3N2Zz4=">
  <style>
    :root {
      --bg-main: #18181b;
      --bg-container: #232134;
      --accent: #6366f1;
      --accent-light: #a1a1aa;
      --text-main: #f8f8f2;
      --link-bg: #25264b;
      --link-bg-active: #4547b0;
    }
    body {
      background: var(--bg-main);
      color: var(--text-main);
      margin: 0;
      font-family: 'Inter','Segoe UI',Arial,sans-serif;
      display: flex;
      align-items: flex-start;
      justify-content: center;
      min-height: 100vh;
    }
    .container {
      background: var(--bg-container);
      border-radius: 22px;
      box-shadow: 0 20px 40px rgba(15,23,42,0.18);
      padding: 3rem 2rem;
      max-width: 600px;
      width: 99%;
      margin: 28px auto 18px auto;
      border: 1.5px solid #313146;
      text-align: center;
    }
    .hero-title {
      font-size: 2.1rem;
      font-weight: 800;
      background: linear-gradient(90deg, var(--accent), var(--accent-light));
      background-clip: text;
      color: transparent;
      -webkit-background-clip: text;
      margin-bottom: 0.5rem;
    }
    .hero-desc {
      color: #a1a1aa;
      font-size: 16px;
      margin-bottom: 1.5rem;
      line-height: 1.56;
    }
    .list-title {
      font-size: 1.27rem;
      margin: 1.1rem 0 0.5rem 0;
      color: var(--accent);
      font-weight: 600;
      letter-spacing: -0.01em;
    }
    .html-list {
      display: flex;
      flex-direction: column;
      align-items: stretch;
      gap: 11px;
      margin-bottom: 8px;
      margin-top: 6px;
    }
    .html-link {
      background: var(--link-bg);
      color: var(--accent);
      text-decoration: none;
      border-radius: 12px;
      padding: 15px 14px;
      font-size: 1.06rem;
      font-weight: 500;
      box-shadow: 0 2px 16px rgba(99,102,241,0.12);
      border: 1px solid #373752;
      transition: background 0.22s, color 0.22s;
      display: flex;
      align-items: center;
      gap: 11px;
      justify-content: space-between;
    }
    .html-link:hover, .html-link:focus {
      background: var(--link-bg-active);
      color: #fff;
    }
    .no-files {
      color: #b83939;
      padding: 10px 5px;
      margin-top: 6px;
      font-size: 15px;
    }
    .editor {
      background: #191924;
      padding: 24px 16px;
      margin-bottom: 24px;
      border-radius: 18px;
      box-shadow: 0 2px 16px rgba(99,102,241,0.17);
    }
    .editor h2 {
      margin-top: 0;
      margin-bottom: 14px;
      background: linear-gradient(90deg,#6366f1,#4ef9fa);
      color: transparent;
      -webkit-background-clip: text;
      background-clip: text;
      font-size: 1.47rem;
      font-weight: 700;
    }
    .editor textarea, .editor input {
      width: 100%;
      font-size: 15px;
      padding: 14px 12px;
      border-radius: 10px;
      background: #27272a;
      color: #f8f8f2;
      border: 2px solid #313146;
      margin-bottom: 10px;
    }
    .editor textarea { min-height: 140px; font-family: 'Fira Code', monospaced; resize: vertical;}
    .editor .btn {
      background: linear-gradient(135deg,#6366f1,#764ba2);
      border: none; color: #fff;
      border-radius: 8px; padding: 11px 18px; font-weight: bold; font-size: 15px; cursor: pointer;
      margin-top: 6px; margin-bottom: 2px; transition: background 0.18s;
    }
    .editor .btn:hover { background: linear-gradient(135deg,#764ba2,#6366f1);}
    .editor .status {font-size: 14px; color: #ffd65c; margin-top: 1rem;}
    @media (max-width:680px){
      .container { padding: 2.2rem 1.1rem;}
      .editor {padding: 15px 7px;}
      .list-title{font-size:1.1rem;}
      .html-link{font-size:1rem;}
      .editor h2{font-size:1.13rem;}
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="editor">
      <h2>Editor Online de Teste HTML</h2>
      <div>
        <input type="text" id="filename" placeholder="nome-do-arquivo.html" value="pagina-teste.html">
      </div>
      <div>
        <textarea id="content" placeholder="<html>Seu HTML aqui...</textarea>
      </div>
      <button class="btn" id="publishBtn">Publicar no repositório</button>
      <div class="status" id="status"></div>
    </div>
    <div class="hero-title">Páginas HTML Publicadas</div>
    <div class="hero-desc">
      Veja e teste os arquivos listados abaixo. Só aparecem arquivos de teste: o editor permanece fixo acima :)
    </div>
    <div class="list-title">Arquivos da pasta <strong>HTML/</strong>:</div>
    <div id="links" class="html-list"></div>
    <div id="empty" class="no-files" style="display:none">Nenhuma página .html encontrada.</div>
  </div>
  <script>
    // Sua config real (credenciais):
    const owner = "tehewdev";
    const repo = "teste-html";
    const dir = "HTML";
    const tokenBin = "690bda10ae596e708f473581";
    const tokenKey = "$2a$10$f9KK7vSowGnJI5elo/dAPurqjZAJ3bJaWnsinl/caDfgIcNt28kNi";
    let githubToken = null;
    
    // Função para buscar o token do jsonbin
    async function fetchToken(){
      const url = `https://api.jsonbin.io/v3/b/${tokenBin}/latest`;
      const response = await fetch(url, { headers: { 'X-Access-Key': tokenKey, 'X-Bin-Meta': 'false' } });
      const data = await response.json();
      return data.github_token;
    }
    // Publicar novo arquivo HTML
    async function publishFile(){
      const filename = document.getElementById("filename").value.trim();
      const content = document.getElementById("content").value.trim();
      const status = document.getElementById("status");
      if(!filename || !filename.endsWith(".html")){
        status.textContent = "Use um nome '.html' válido!";
        return;
      }
      if(!content){ status.textContent = "Conteúdo do HTML vazio!"; return;}
      status.textContent = "Publicando...";
      if(!githubToken) githubToken = await fetchToken();
      // Tenta salvar via GitHub API
      try {
        const path = `${dir}/${filename}`;
        const url = `https://api.github.com/repos/${owner}/${repo}/contents/${path}`;
        // Verifica se já existe pra buscar SHA
        let sha = null;
        try {
          const res = await fetch(url, { headers: { Authorization: `Bearer ${githubToken}` } });
          if(res.ok){
            const filedata = await res.json();
            sha = filedata.sha;
          }
        }catch{}
        // Monta payload
        const payload = {
          message: sha ? `Atualizando ${filename}` : `Criando ${filename}`,
          content: btoa(unescape(encodeURIComponent(content))),
          branch: "main"
        };
        if(sha) payload.sha = sha;
        const result = await fetch(url, {
          method: "PUT",
          headers: { Authorization: `Bearer ${githubToken}`, "Content-Type":"application/json" },
          body: JSON.stringify(payload)
        });
        if(!result.ok){
          const err = await result.json();
          status.textContent = "Erro: "+(err.message || result.statusText);
        } else {
          status.textContent = `Publicado: ${filename}`;
          document.getElementById("filename").value = "";
          document.getElementById("content").value = "";
          loadList();
        }
      }catch(e){
        status.textContent = "Erro ao publicar!";
      }
    }
    document.getElementById("publishBtn").onclick = publishFile;

    // LISTA arquivos da pasta ignorando index.html
    async function loadList(){
      const links = document.getElementById("links");
      const empty = document.getElementById("empty");
      links.innerHTML = "";
      if(!githubToken) githubToken = await fetchToken();
      const res = await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/${dir}`, { headers:{ Authorization: `Bearer ${githubToken}` }});
      const files = await res.json();
      let count = 0;
      files.forEach(file => {
        if(file.name.endsWith(".html") && file.name !== "index.html") {
          const a = document.createElement("a");
          a.href = `${dir}/${file.name}`;
          a.className = "html-link";
          a.textContent = file.name;
          a.target = "_blank";
          links.appendChild(a);
          count++;
        }
      });
      if(count === 0){
        empty.style.display = "block";
      }else{
        empty.style.display = "none";
      }
    }
    window.onload = loadList;
  </script>
</body>
</html>
